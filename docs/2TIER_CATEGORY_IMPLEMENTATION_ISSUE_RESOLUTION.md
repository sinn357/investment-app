# 2단계 카테고리 시스템 구현 문제 해결 가이드

## 개요

포트폴리오 자산 관리를 위한 대분류-소분류 2단계 카테고리 시스템 구현 중 발생한 JSX 파싱 오류 및 기능 불완전 문제 해결 과정을 문서화합니다.

### 문제 발생일: 2025-09-22
### 현재 상태: 🔄 진행 중 (JSX 파싱 오류로 중단)
### 관련 파일:
- `frontend/src/components/PortfolioDashboard.tsx`
- `backend/services/postgres_database_service.py` (sub_category 지원 완료)

---

## 문제 상황

### 1. 기능 불완전 상태
- **사용자 피드백**: "포트폴리오 상세에서 대분류별로 보게 되어있잖아. 그 안에 소분류 별로 보게 해놓아야지. 그 작업을 마친거 아니였어? 그리고 소분류를 입력해도 소분류 표시조차 안뜨는데 여태 뭘한거야?"
- **문제점**: 백엔드에는 sub_category 데이터가 있으나 프론트엔드에서 2단계 중첩 구조로 표시되지 않음
- **현재 상태**: 단일 레벨 그룹화만 작동, 소분류 입력 필드 부재

### 2. JSX 파싱 오류 재발
```
⨯ ./src/components/PortfolioDashboard.tsx:975:1
Parsing ecmascript source code failed
Unexpected token. Did you mean `{'}'}` or `&rbrace;`?
```

---

## 구현 진행 상황

### ✅ 완료된 작업

1. **백엔드 지원 확인**
   - PostgreSQL `assets` 테이블에 `sub_category` 컬럼 존재
   - `/api/portfolio` 응답에 sub_category 데이터 포함
   - 자산 추가/수정 시 sub_category 저장 가능

2. **프론트엔드 기본 구조**
   - Asset 인터페이스에 `sub_category: string | null` 추가
   - getGroupedAssets 함수를 2단계 중첩 구조로 수정:
   ```typescript
   const grouped: Record<string, Record<string, typeof filtered>> = {};
   ```

### 🔄 진행 중인 작업

3. **중첩 테이블 UI 구현**
   - 대분류(파란 헤더) > 소분류(회색 헤더) > 자산 테이블 구조
   - SubCategorySection 컴포넌트 분리 시도 (JSX 복잡도 해결)
   - **현재 상태**: JSX 파싱 오류로 중단

### ⏸️ 대기 중인 작업

4. **소분류 입력 필드 추가**
   - 자산 추가/수정 모달에 소분류 입력 필드
   - 대분류 선택 시 소분류 옵션 동적 표시

---

## 기술적 분석

### JSX 파싱 오류 원인
1. **복잡한 중첩 구조**: Object.entries() 이중 중첩으로 인한 브레이스 매칭 문제
2. **컴파일러 혼동**: JavaScript 표현식과 정규식 리터럴 구분 실패
3. **Next.js 15.5.3 Turbopack**: 새로운 번들러에서 더 엄격한 파싱 규칙

### 시도한 해결책
1. **컴포넌트 분리**: SubCategorySection으로 중첩 로직 분리
2. **캐시 정리**: .next 디렉토리 및 node_modules/.cache 삭제
3. **파일 복원**: git checkout으로 안정 상태 복원

---

## 다음 단계 계획

### 1단계: 안전한 빌드 복원
- 현재 ecb23e1 커밋 상태로 완전 복원
- 개발 서버 정상 실행 확인

### 2단계: 점진적 구현
- 먼저 소분류 **표시**만 추가 (기존 단일 테이블에 sub_category 컬럼)
- 빌드 성공 확인 후 중첩 구조 구현

### 3단계: 소분류 입력 기능
- 자산 추가/수정 폼에 소분류 필드 추가
- 대분류별 소분류 옵션 제공

### 4단계: 2단계 중첩 UI
- 안전한 방식으로 대분류 > 소분류 중첩 테이블 구현
- 별도 컴포넌트 파일로 완전 분리 고려

---

## 소분류 체계 설계

### 대분류 (유동성 기준)
- **즉시현금**: 즉시 사용 가능한 현금성 자산
- **예치자산**: 예금, 적금 등 안전한 예치 자산
- **투자자산**: 주식, 펀드, ETF, 채권 등 투자 상품
- **대체투자**: 부동산, 암호화폐, 원자재 등 대체 투자

### 소분류 (상품 유형별)
- **즉시현금**: 현금, 입출금통장, 증권예수금
- **예치자산**: 예금, 적금, MMF
- **투자자산**: 국내주식, 해외주식, 펀드, ETF, 채권
- **대체투자**: 암호화폐, 부동산, 원자재

---

## 기존 자산 데이터 상태

현재 포트폴리오에 저장된 자산들의 sub_category 필드 상태:
- 일부 자산은 sub_category 데이터 보유
- 일부 자산은 null 상태 (기본값으로 "기타" 처리 필요)

---

## 위험 요소

1. **JSX 복잡도**: 3단계 이상 중첩 시 파싱 오류 재발 가능성
2. **데이터 일관성**: 기존 null 값과 신규 소분류 데이터 혼재
3. **성능**: 중첩 그룹화로 인한 렌더링 성능 영향

---

## 세션 재개 방법

### 다음 세션 시작 명령어
```
"2단계 카테고리 시스템 구현을 계속해줘. 먼저 PortfolioDashboard에서 소분류를 표시부터 시작하자."
```

### 현재 Todo 상태
1. ✅ Asset 인터페이스에 sub_category 필드 추가
2. ✅ 2단계 그룹화 로직 구현 (대분류 > 소분류)
3. 🔄 중첩 테이블 UI 구현 (안전한 방식)
4. ⏸️ 소분류 입력 필드 추가

### 우선순위 작업
1. **즉시 해결**: 개발 서버 정상화 및 빌드 오류 해결
2. **단계적 구현**: 소분류 표시 → 입력 기능 → 중첩 UI
3. **검증**: 각 단계별 빌드 성공 및 기능 테스트

---

## 참고 문서
- [2단계 카테고리 시스템 구현 가이드](./2TIER_CATEGORY_SYSTEM_IMPLEMENTATION.md)
- [Vercel 빌드 오류 해결 가이드](./VERCEL_BUILD_ERROR_RESOLUTION.md)
- [CLAUDE.md Tasks T-052](../CLAUDE.md#tasks-single-source-of-truth)